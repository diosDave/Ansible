- hosts: "{{ hosts }}"

tasks:

  - name: Get disk Usage
    command: df -h
    register: disk_usage

  - name: Check disk space available
    shell: df -h / | awk 'NR==2 {print $5}'
    register: disk_usage

    #send teams notificaiton using webhook
  - name: Send Teams Message
    url:
      url: "https://qcsdirect.webhook.office.com/webhookb2/16f75652-74b3-4249-a55f-d1386ffb7b59@c1894785-35b8-4b62-ba33-c49bb9db2f4b/IncomingWebhook/cebfd2e6887040b2951bccec24573ffe/b67c22a2-26eb-406d-9011-365f6d6ac197"
      method: POST
      body_format: json
      body: '{"content": "Disk space on {{ inventory_hostname }} is above 80%!"}'
      headers:
        Content-Type: application/json
      status_code: 204
    when: disk_usage.stdout[:-1]|int > 80